---
title: Binary data in state space models
author: Charles Driver
date: '2021-5-28'
lastmod: 2020-8-14T18:33:24+01:00
slug: BinaryData
output: html_document
featured: no
image:
  caption: ''
preview_only: no
---



<div id="generate-some-data" class="section level2">
<h2>Generate some data</h2>
<p>Here we specify a bivariate latent process where the 1st process affects the 2nd, and there are stable individual differences in the processes.</p>
<pre class="r"><code>library(ctsem)
gm &lt;- ctModel(LAMBDA=diag(2), #diagonal factor loading, 2 latents 2 observables
  Tpoints = 50,
  DRIFT=matrix(c(-1,.5,0,-1),2,2), #temporal dynamics
  TRAITVAR = diag(.5,2), #stable latent intercept variance (cholesky factor)
  DIFFUSION=diag(2)) #within person covariance 

ctModelLatex(gm) #to view latex system equations

#when generating data, free pars are set to 0
d &lt;- data.frame(ctGenerate(ctmodelobj = gm,n.subjects = 100,
  burnin = 20,dtmean = .1))</code></pre>
<p><img src="/post/BinaryData_files/figure-html/TEX-1.png" width="672" /></p>
<p>We didn’t specify any measurement error in the above code, because we’re going to mix the regular Gaussian approach with binary data measurements:</p>
<pre class="r"><code>d$Y2binary &lt;-rbinom(n = nrow(d),size = 1, #create binary data based on the latent
  prob = ctsem::inv_logit(d$Y2))
d$Y1 &lt;- d$Y1 + rnorm(nrow(d),0,.2) #gaussian measurement error</code></pre>
<p>Now we setup our model for estimation – we no longer hard code the values of the simulation! We also fix the MANIFESTMEANS (measurement intercept) and free the CINT (continuous / latent process intercept) because that will be more appropriate if there are stable differences in the latent process. In Gaussian cases this choice of how to identify the model very often makes no difference, but it is more crucial with non-linearity. Note that there are many system matrices left unspecified, which will be freely estimated by default, and note also that correlated individual differences are enabled by default for all intercept terms (in this case, inital latent process intercepts, and continuous intercepts). The final step is to specify the measurement model by altering the model object directly – once the binary feature gets more development time I will probably create a nicer approach for this. 0 for the first manifest specifies that it is Gaussian, while the 1 specifies that our second variable (listed in manifestNames) is binary.</p>
<pre class="r"><code>m &lt;- ctModel(LAMBDA=diag(2),type=&#39;stanct&#39;,
  manifestNames = c(&#39;Y1&#39;,&#39;Y2binary&#39;),
  MANIFESTMEANS = 0,
  CINT=c(&#39;cint1&#39;,&#39;cint2&#39;))
##      [,1]
## [1,]  &quot;0&quot;
## [2,]  &quot;0&quot;
##      [,1]   
## [1,] &quot;cint1&quot;
## [2,] &quot;cint2&quot;

m$manifesttype=c(0,1)</code></pre>
<p>Then we fit and summarise the model – note that at time of writing the latex output doesn’t know about the binary measurement model for the 2nd observable, and incorrectly shows the errors as Gaussian.</p>
<pre class="r"><code>f &lt;- ctStanFit(datalong = d,ctstanmodel = m,cores=6)
s=summary(f)
print(s$popmeans)
##                    mean     sd    2.5%     50%   97.5%
## T0m_eta1        -0.0458 0.0869 -0.1312 -0.0686  0.0985
## T0m_eta2        -0.0922 0.1993 -0.2988 -0.1488  0.2078
## drift_eta1      -1.1594 0.2148 -1.4699 -1.1525 -0.9054
## drift_eta1_eta2 -0.0301 0.0748 -0.1163 -0.0441  0.0834
## drift_eta2_eta1  0.2036 0.2476 -0.1248  0.1879  0.5339
## drift_eta2      -1.5657 0.9102 -3.1002 -1.2331 -0.9221
## diff_eta1        1.0299 0.0259  0.9899  1.0360  1.0600
## diff_eta2_eta1   0.1112 0.2679 -0.2749  0.1465  0.4524
## diff_eta2        1.1231 0.2898  0.8680  1.0219  1.5403
## mvarY1           0.1919 0.0054  0.1826  0.1938  0.1953
## cint1            0.0257 0.1049 -0.1149  0.0126  0.1470
## cint2            0.2688 0.1645  0.0552  0.2704  0.4969
ctModelLatex(f)</code></pre>
<p><img src="/post/BinaryData_files/figure-html/texfit-1.png" width="672" /></p>
<p>Then add a few plots showing temporal regression coefficients conditional on time interval, measurement expectations conditional on estimated parameters and past data, and finally latent states conditional on estimated parameters and both past and future data.</p>
<pre class="r"><code>ctStanDiscretePars(f,plot=T)</code></pre>
<p><img src="/post/BinaryData_files/figure-html/unnamed-chunk-5-1.png" width="100%" height="100%" style="display: block; margin: auto;" /></p>
<pre class="r"><code>
ctKalman(f,subjects = c(2,5),plot=T)</code></pre>
<p><img src="/post/BinaryData_files/figure-html/unnamed-chunk-5-2.png" width="100%" height="100%" style="display: block; margin: auto;" /></p>
<pre class="r"><code>ctKalman(f,subjects = c(2,5),plot=T,kalmanvec=c(&#39;etasmooth&#39;))</code></pre>
<p><img src="/post/BinaryData_files/figure-html/unnamed-chunk-5-3.png" width="100%" height="100%" style="display: block; margin: auto;" /></p>
</div>
